// /app/[[...rewardCode]]/page.tsx
import { supabase } from "@/lib/supabaseClient";

export default async function RewardPage({ params }: { params: { rewardCode?: string[] } }) {
  const codeParam = params.rewardCode?.[0] ?? "";
  const match = codeParam.match(/^reward=(.+)$/);

  if (!match) {
    return <div className="p-6 text-center">Invalid or missing reward code.</div>;
  }

  const rewardCode = match[1];

  const { data, error } = await supabase
    .from("claimed_rewards")
    .select("*, cards(*)")
    .eq("code", rewardCode) // match column name in your DB
    .single();

  if (error || !data) {
    return <div className="p-6 text-center">Reward not found or expired.</div>;
  }

  return (
    <div className="p-6 text-center">
      <h1 className="text-2xl font-bold">ðŸŽ‰ Your Reward</h1>
      <p className="mt-2 text-lg">{data.cards.header}</p>
      <p className="italic text-gray-600">{data.cards.subheader}</p>
      <p className="text-xs mt-4 text-gray-500">
        Expires: {new Date(data.cards.expires).toLocaleDateString()}
      </p>
    </div>
  );
}
